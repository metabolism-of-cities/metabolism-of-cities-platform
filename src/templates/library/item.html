{% extends "_base.html" %}
{% load humanize %}
{% load static %}

{% block page_name %}library item fullwidth{% endblock %}
{% block title %}{{ info }}{% endblock %}

{% block head %}
  <link rel="canonical" href="{{ info.get_full_url }}" />
  <!-- When we have fully figured all this out we can consider getting it indexed. Ensure there is a canonical link as this page is generated with various URLs -->
  <meta name="robots" content="noindex">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Share Popup</title>
  <script crossorigin="anonymous"></script>
  <style>
      /* Overlay */
      .overlay {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.6);
          z-index: 999;
      }

      /* Share popup container */
      .share-popup {
          display: none;
          position: fixed;
          bottom: -100%;
          left: 50%;
          transform: translateX(-50%);
          background: white;
          padding: 30px;
          box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
          border-radius: 10px;
          text-align: center;
          width: 90%;
          max-width: 450px;
          z-index: 1000;
          transition: bottom 0.3s ease-in-out;
      }

      /* Show animation */
      .share-popup.show {
          bottom: 20px;
      }

      /* Share popup heading */
      .share-popup h3 {
          margin: 10px 0;
          color: #333;
          font-size: 18px;
      }

      /* Share icons container */
      .share-icons {
          display: flex;
          justify-content: space-around;
          padding: 10px 0;
      }

      /* Share buttons */
      .share-icons a {
          text-decoration: none;
          font-size: 24px;
          width: 50px;
          height: 50px;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 50%;
          color: white;
          transition: transform 0.2s ease-in-out;
      }

      /* Hover effect */
      .share-icons a:hover {
          transform: scale(1.1);
      }

      /* Individual colors */
      .email { background: #D44638; } /* Gmail red */
      .outlook { background: #1da1f2; } /* Outlook blue */
      .facebook { background: #3b5998; }
      .twitter { background: #1da1f2; }
      .linkedin { background: #0077b5; }
      .reddit { background: #ff4500; }

      /* Close button */
      .close-btn {
          display: inline-block;
          background: #dc3545;
          color: white;
          padding: 8px 20px;
          border-radius: 5px;
          cursor: pointer;
          margin-top: 10px;
          font-size: 14px;
      }
  </style>
{% endblock %}

{% block css %}
  <style>
    .journal {
      max-height: 160px;
    }

    .videoblock {
      background: #000;
    }

    .video-embed {
      width: 100%;
      height: 70vh;
    }

    .largeicon {
      font-size: 5rem;
    }

    .top-message-box .alert {
      text-align: center;
    }

    audio {
      width: 100%;
    }

    .fullwidth-hr {
      margin-left: -1rem;
      width: calc(100% + 2rem);
    }

    #bib,
    #ris {
      white-space: pre-wrap;
    }

    #citation-tab .nav-item.nav-link {
      color: #000 !important;
    }

    {% if info.is_deleted %}
      .main-content .container {
        opacity: .3;
      }
    {% endif %}

    {% if request.user.is_superuser %}
      #metadata .alert{margin-bottom:0}
      #metadata .contentblock { display: none; margin-top:1rem}
      #metadata .alert:hover {color:black;cursor:pointer}
    {% endif %}
    .admin-option{display:none}
  
    /* Overlay background */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
    }

    /* Modal */
    .export-modal {
      display: none;
      position: fixed;
      top: -100%;
      left: 50%;
      transform: translateX(-50%);
      width: 400px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      padding: 25px;
      z-index: 1000;
      transition: all 0.5s ease;
    }

    /* Show state for animation */
    .export-modal.show {
      top: 20%;
    }

    .export-modal-content h4 {
      margin-top: 0;
    }

    .close-modal {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 22px;
      cursor: pointer;
      color: #999;
    }

    .close-modal:hover {
      color: #333;
    }

    .export-options {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .export-card {
      background-color: #f9f9f9;
      border-radius: 10px;
      padding: 20px 25px;
      width: 100px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.3s ease, background-color 0.3s;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .export-card:hover {
      background-color: #f0f0f0;
      transform: translateY(-5px);
    }

    .export-card i {
      display: block;
      margin-bottom: 10px;
      color: #4a4a4a;
    }

    .export-card span {
      font-size: 14px;
      color: #333;
    }

  </style>
{% endblock %}

{% block content %}

{% if spaces and False %}
  <section class="fullwidth-wrapper">
    <div class="container">
      <iframe class="dataset card" src="{% url 'data:dataset' info.id %}" onload="resizeIframe(this)"></iframe>
    </div>
  </section>
{% endif %}

<div class="container">
  <div class="row">
    <div class="col-lg-4 pb-4 order-2 order-lg-1" {% if data_layout %}hidden{% endif %}>
      {% if publisher.image %}
        <div class="text-center">
          <a href="{{ publisher.get_absolute_url }}">
            <img src="{{ publisher.image.thumbnail.url }}" class="journal rounded mt-4">
          </a>
        </div>
      {% else %}
        <div class="p-4 bg-light rounded border text-center">
          <span class="largeicon">
            <i class="fal fa-{{ info.type.icon }}"></i>
          </span>
        </div>
      {% endif %}

      {% if info.file %}
        <div class="mt-3 mb-2"><a href="{{ info.file.url }}" class="btn btn-primary"><i class="fa fa-download"></i> Download</a></div>
      {% elif info.image and info.type.name == "Image" %}
        <div class="mt-3 mb-2"><a href="{{ info.image.url }}" class="btn btn-primary"><i class="fa fa-download"></i> Download</a></div>
        {% if request.user.id == 1 %}
          <div class="mt-3 mb-2"><a href="./?reload=true" class="btn btn-warning"><i class="fa fa-sync"></i> Re-create thumbnail</a></div>
        {% endif %}
      {% endif %}

      <div class="border rounded bg-white my-4">
        <ul class="list-group list-group-flush">
          <!-- export item -->
          {% if request.user.is_authenticated %}
            <div id="exportModalOverlay" class="modal-overlay"></div>

            <div id="exportModal" class="export-modal">
              <div class="export-modal-content">
                <span class="close-modal">&times;</span>
                <h5>Please choose the format to export:</h5>
                
                <h6>File(s):</h6>
                <div class="export-options">
                  <div class="export-card" id="exportTxt">
                    <i class="fal fa-file-alt fa-2x"></i>
                    <span>.TXT</span>
                  </div>
                  {% if attachments %}
                    <div class="export-card" id="exportCsv">
                      <i class="fal fa-file-csv fa-2x"></i>
                      <span>.CSV</span>
                    </div>

                    <script>
                      const attachments = {{ attachments|safe|json_script:"attachment-data" }};
                    </script>
                  {% endif %}
                  <div class="export-card" id="exportPdf">
                    <i class="fal fa-file-pdf fa-2x"></i>
                    <span>.PDF</span>
                  </div>
                </div>
                <br>
                <h6>Reference Manager:</h6>
                <div class="export-options">
                  <div class="export-card" id="exportZotero">
                    <i class="fal fa-book fa-2x"></i>
                    <span>Zotero</span>
                  </div>
                </div>
              </div>
            </div>    

            <li class="list-group-item table-item">
              <div><i class="fal fa-fw fa-bookmark mr-1"></i>Export</div>
              <div>
                <span class="export-btn" data-item-id="{{ info.id }}" role="button" tabindex="0"
                  style="cursor: pointer; color: inherit; background: none; border: none; padding: 0; font: inherit; display: inline-flex; align-items: center;">
                  <i class="fal fa-upload"></i>
                </span>
              </div>
            </li>

            <div id="zoteroSuccessModalOverlay" class="modal-overlay"></div>

            <div id="zoteroSuccessModal" class="export-modal">
              <div class="export-modal-content">
                <span class="close-modal">&times;</span>
                <h4 style="text-align:center;">
                  <i class="fas fa-check-circle" style="color:green;"></i><br>
                  Successfully Exported to Zotero!
                </h4>
                <p style="text-align:center;">This item was added to your Zotero library.</p>
              </div>
            </div>
          {% endif %}
          <li class="list-group-item table-item">
            <div><i class="fal fa-fw fa-{{ info.type.icon }} mr-1"></i>
              {% if PROJECT.slug == "peeide" %}Reference{% endif %}
              Type 
            </div>
            <div>{{ info.type }}</div>
          </li>

          <li class="list-group-item table-item">
            <div>
              <i class="fal fa-fw fa-share-square"></i>
              Share
            </div>
            <div><i class="fal fa-fw fa-share share-button" onclick="openSharePopup()"></i></div>
          </li>

          <style>
            .share-button {
              transition: transform 0.3s ease-in-out;
            }

            .share-button:hover {
              transform: scale(1.2);
              cursor: pointer;
            }
          </style>

          <!-- Overlay -->
          <div class="overlay" id="overlay" onclick="closeSharePopup()"></div>

          <!-- Share Popup -->
          <div class="share-popup" id="sharePopup">
              <h3>Share This Item</h3>
              <div class="share-icons">
                <a href="#" class="email" onclick="shareEmail()"><i class="fab fa-google"></i></a>
                <a target="_top" href="#" class="outlook" onclick="shareOutlook()"><i class="fal fa-envelope"></i></a>
                <a href="#" class="facebook" onclick="shareFacebook()"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="twitter" onclick="shareTwitter()"><i class="fab fa-twitter"></i></a>
                <a href="#" class="linkedin" onclick="shareLinkedIn()"><i class="fab fa-linkedin-in"></i></a>
                <a href="#" class="reddit" onclick="shareReddit()"><i class="fab fa-reddit-alien"></i></a>
            </div>
            <div class="close-btn" onclick="closeSharePopup()">Close</div>
          </div>


          {% if publisher %}
            <li class="list-group-item table-item">
              <div><i class="fal fa-fw fa-building mr-1"></i>
                {% if info.type.name == "Journal Article" %}
                  Published in
                {% else %}
                  Publisher
                {% endif %}
              </div>
              <div><a href="{{ publisher.get_absolute_url }}">{{ publisher }}</a></div>
            </li>
          {% endif %}

          {% if PROJECT.slug != "ascus2021" and PROJECT.slug != "ascus2024" %}

            {% if info.year %}
              <li class="list-group-item table-item">
                <div><i class="fal fa-fw fa-calendar mr-1"></i> Year</div>
                <div>{{ info.year }}</div>
              </li>
            {% endif %}

            {% if info.author_list %}
              <li class="list-group-item">
                <i class="fal fa-fw fa-user-edit mb-1 mr-1" aria-hidden="true"></i> Author(s)
                <br>
                {{ info.author_list }}
              </li>
            {% endif %}

            {% if tags %}
              <li class="list-group-item hide-water">
                <i class="fal fa-fw fa-tag mb-1 mr-1" aria-hidden="true"></i> {% if PROJECT.slug == "peeide" %}Keywords{% else %}Tags{% endif %}
                <br>
                {% for each in tags %}
                  {% if not each.hidden %}
                    <a class="btn btn-sm btn-primary-outline mt-1" href="{% url URLS.LIBRARY %}?find=true&amp;search={{ each.id }}&amp;types=all">{{ each }}</a>
                  {% endif %}
                {% endfor %}
              </li>
            {% endif %}

            {% if info.language and not info.type.name == "Image" %}
            <li class="list-group-item table-item hide-water">
              <div><i class="fal fa-fw fa-language mr-1"></i> Language</div>
              <div>{{ info.get_language_display }}</div>
            </li>
            {% endif %}

            {% if info.license %}
              <li class="list-group-item table-item">
                <div><i class="fal fa-fw fa-universal-access mr-1"></i> License</div>
                <div>{{ info.license }}</div>
              </li>
            {% endif %}
          {% endif %}

          {% if info.url %}
            <li class="list-group-item table-item">
              {% if info.type.name == "Report" or info.type.name == "Dataset" or info.type.name == "Document" %}
                <div><i class="fal fa-fw fa-download mr-1"></i> Download</div>
              {% else %}
                <div><i class="fal fa-fw fa-link mr-1"></i> URL</div>
              {% endif %}
              <div class="text-truncate">
                <a href="{{ info.url }}">{{ info.url }}</a>
              </div>
            </li>
          {% endif %}

          {% if info.open_access == False %}
            <li class="list-group-item table-item">
              <div><i class="fal fa-fw fa-lock mr-1"></i> Access</div>
              <div class="text-truncate">
                Behind paywall
              </div>
            </li>
          {% endif %}

          {% if info.open_access == True %}
            <li class="list-group-item table-item">
              <div><i class="fal fa-fw fa-lock-open mr-1"></i> Access</div>
              <div class="text-truncate">
                Open access
              </div>
            </li>
          {% endif %}

          {% if info.doi %}
            <li class="list-group-item table-item">
                <div><i class="fal fa-fw fa-tag mr-1"></i> DOI</div>
              <div class="text-truncate">
                <a href="{{ info.get_doi_url }}">{{ info.doi }}</a>
              </div>
            </li>
          {% endif %}

          {% if info.isbn %}
            <li class="list-group-item">
              <i class="fal fa-fw fa-tag mb-1 mr-1" aria-hidden="true"></i> ISBN
              <br>
              <span class="badge badge-primary">{{ info.isbn }}</span>
            </li>
          {% endif %}

          {% if PROJECT.slug != "ascus2024" %}
          <li class="list-group-item hide-water">
            <i class="fal fa-fw fa-quote-right mb-1 mr-1" aria-hidden="true"></i> Citation
            <br>
            <a class="btn btn-sm btn-primary-outline load-citation" data-tab="apa" data-toggle="modal" data-target="#citation" href="#citation">
              APA
            </a>
            <a class="btn btn-sm btn-primary-outline load-citation" data-tab="bib" data-toggle="modal" data-target="#citation" href="#citation">
              BibTeX
            </a>
            <a class="btn btn-sm btn-primary-outline load-citation" data-tab="ris" data-toggle="modal" data-target="#citation" href="#citation">
              RIS
            </a>
            <!-- <a class="btn btn-sm btn-primary-outline" href="?format=bibtex&amp;download=true">Add to reference manager</a> -->
          </li>
          {% endif %}

          {% if info.type.group == "academic" and PROJECT.slug != "ascus2021" and PROJECT.slug != "water" and PROJECT.slug != "ascus2024" %}
          <li class="list-group-item">
            <i class="fal fa-fw fa-search mb-1 mr-1" aria-hidden="true"></i> Search
            <br>
            <a class="btn btn-sm btn-primary-outline mt-1" href="https://scholar.google.com/scholar?q={{ info|urlencode }}">Google Scholar</a>
            <a class="btn btn-sm btn-primary-outline mt-1" href="https://google.com/search?q={{ info|urlencode }}">Google</a>
          </li>
          {% endif %}

          {% if info.uploader %}
          <li class="list-group-item table-item hide-water">
            <div><i class="fal fa-fw fa-user mr-1"></i> Uploaded by</div>
            <div>
              {{ info.uploader.name_and_link }}
            </div>
          </li>
          {% endif %}

          {% if info.contact_email %}
          <li class="list-group-item table-item hide-water">
            <div><i class="fal fa-fw fa-envelope"></i> Contact</div>
            <div>
              {{ info.contact_email }}
            </div>
          </li>
          {% endif %}

          {% if info.processor %}
          <li class="list-group-item table-item hide-water">
            <div><i class="fal fa-fw fa-user mr-1"></i> Processed by</div>
            <div>
              <a href="{% url URLS.PROFILE info.processor.id %}">{{ info.processor }}</a>
            </div>
          </li>
          {% endif %}

          {% if not info.is_public %}
            <li class="list-group-item table-item">
              <div><i class="fal fa-fw fa-ban mr-1"></i> Access</div>
              <div>
                <span class="badge bg-warning p-1 mr-2" title="This document is not publicly accessible.">
                  <i class="fa fa-lock"></i>
                  <strong>Private</strong>
                </span>
              </div>
            </li>
          {% endif %}

          <li class="list-group-item table-item">
            <div><i class="fal fa-fw fa-fingerprint mr-1"></i> ID</div>
            <div class="text-monospace"><code>{{ info.id }}</code></div>
          </li>
          
        </ul>
      </div>

      {% if PROJECT.slug == "ascus" or PROJECT.slug == "ascus2021" or PROJECT.slug == "ascus2024" %}

        {% if info.author_list %}
          <div class="card">
            <ul class="list-group list-group-flush">
              <li class="list-group-item">
                <i class="fal fa-fw fa-user-edit mb-1 mr-1" aria-hidden="true"></i>
                <strong>
                Author(s)
                </strong>
                <br>
                {{ info.author_list }}
              </li>
            </ul>
          </div>
        {% endif %}

        {% for each in authors_temp %}
          <div class="card mt-4">
            {% if each.image %}
            <a href="{% url 'ascus2024:participant' each.id %}">
              <img class="card-img-top" src="{{ each.image.thumbnail.url }}">
            </a>
            {% endif %}
            <div class="card-body">
              <div class="mb-4">
                <span class="details">
                  {% if each.image %}
                  <a href="{% url 'ascus2024:participant' each.id %}">
                    <strong>{{ each }}</strong>
                  </a>
                  {% else %}
                    <strong>{{ each }}</strong>
                  {% endif %}

                  {% if each.email %}
                  <br>
                  {{ each.email }}
                  {% endif %}
                </span>
              </div>

            </div>
          </div>
        {% endfor %}

        <form method="post" class="form form-horizontal mt-2" action="{% url 'ascus2024:account_vote' %}" hidden>
          {% csrf_token %}
          <div class="alert alert-warning">
            <h3>Best PTA</h3>
            <p>
            {% if best_vote %}
                You already cast your vote
            {% else %}
              <button type="submit" class="btn btn-success" name="best_pta" value="{{ info.id }}"><i class="fa fa-vote-yea"></i> Vote for this path-to-action document.</button>
              <input type="hidden" name="next" value="{{ request.get_full_path }}" />
            {% endif %}
            </p>
          </div>
        </form>

        {% if curator or request.user.people == info.uploader or request.user.people == info.author %}
          <a href="?edit&amp;return={{ request.get_full_path }}" class="btn btn-primary"><i class="fa fa-pencil"></i> Edit</a>
        {% endif %}

      {% else %}

        {% if request.user.is_authenticated %}

          <div class="list-group mb-4">
            {% if curator or request.user.people == info.uploader %}
              <a href="?edit&amp;return={{ request.get_full_path }}" class="list-group-item list-group-item-action list-group-item-primary">
                <i class="fal fa-fw fa-pencil mr-1"></i> Edit
              </a>

              {% if info.type.name != "Image" and info.type.name != "Data visualisation" and info.type.name != "Dataset" or PROJECT.slug == "cityloops" %}
                <a href="{% url 'library:upload' %}form/?inventory=true&amp;type=38&amp;parent={{ info.id }}&amp;next={% if request.GET.next %}{{ request.GET.next }}{% else %}{{ request.get_full_path }}{% endif %}" class="list-group-item list-group-item-action list-group-item-primary">
                  <i class="fal fa-fw fa-plus mr-1"></i> Add image
                </a>

                <a href="{% url 'library:upload' %}form/?inventory=true&amp;type=33&amp;parent={{ info.id }}&amp;next={% if request.GET.next %}{{ request.GET.next }}{% else %}{{ request.get_full_path }}{% endif %}" class="list-group-item list-group-item-action list-group-item-primary">
                  <i class="fal fa-fw fa-plus mr-1"></i> Add data visualisation
                </a>
              {% endif %}

            {% endif %}
            {% if curator and IS_DATA_PORTAL and url_processing %}

              {% if not info.meta_data.processed %}
                <a href="{% url url_processing info.id %}" class="list-group-item list-group-item-action list-group-item-primary">
                  <i class="fal fa-fw fa-layer-group mr-1"></i> Process this file
                </a>
              {% else %}
                {% with link=PROJECT.slug|add:":chart_editor" %}
                  <a href="{% url link info.id %}?next={{ request.get_full_path }}{% if active_data_viz %}&amp;viz={{ active_data_viz.id }}{% endif %}" class="list-group-item list-group-item-action list-group-item-primary">
                    <i class="fal fa-fw fa-{% if info.is_map %}map-marker-edit{% else %}chart-pie{% endif %} mr-1"></i> {% if info.is_map %}Map{% else %}Chart{% endif %} editor
                  </a>
                {% endwith %}
              {% endif %}

              {% if request.user.is_staff %}

                    <a href="#" class="list-group-item list-group-item-action list-group-item-primary mr-1" id="view-admin-options">
                      <i class="fal fa-fw fa-lock mr-1"></i> View admin options
                    </a>

                {% if info.meta_data.processed %}

                  {% if data_count %}
                        
                    <a href="?create_cache=true" class="list-group-item list-group-item-action list-group-item-primary mr-1 admin-option">
                      <i class="fal fa-fw fa-brackets-curly mr-1"></i> Generate and cache chart
                      <br>
                      <small>
                      Use this if the chart does not appear here. We will generate the chart on the server and store the results in memory (cache).
                      </small>
                    </a>

                    <a href="?delete_cache=true" class="list-group-item list-group-item-action list-group-item-primary mr-1 admin-option">
                      <i class="fal fa-fw fa-trash mr-1"></i> Remove all cached charts
                    </a>

                  {% endif %}

                  <a href="?reset_processing=true" class="list-group-item list-group-item-action list-group-item-primary mr-1 admin-option">
                    <i class="fal fa-fw fa-layer-group mr-1"></i> RESET processing
                    <br>
                    <small>
                      This means that the file can be processed again. 
                      <strong>Existing reference spaces and associated info (including data!) will be lost!</strong>
                    </small>
                  </a>

                {% endif %}

                {% if info.meta_data.processing_error %}
                  <a href="?skip_size_check=true" class="list-group-item list-group-item-action list-group-item-primary admin-option">
                    <i class="fal fa-fw fa-layer-group mr-1"></i> Overwrite large-file block
                    <br>
                    <small>
                      If you mark this, it means that all reference spaces will be imported, even if this is too large. We also mark this as
                      'ready for processing'. Only mark this if someone has finished the processing workflow and it's now in limbo until
                      this restriction is lifted.
                    </small>
                  </a>
                {% endif %}
              {% endif %}
            {% endif %}

            {% if curator or request.user.people == info.uploader %}
              <a onclick="javascript:return confirm('Are you sure?')"
                 href="?delete&amp;return={{ request.get_full_path }}"
                 class="list-group-item list-group-item-action list-group-item-danger">
                <i class="fal fa-fw fa-trash-alt mr-1"></i> Delete
              </a>
            {% endif %}
          </div>

        {% endif %}

      {% endif %}

      <a href="javascript:history.back()" class="btn btn-primary-light">
        <i class="fal fa-arrow-left"></i> Back
      </a>
    </div>
    <div class="col-lg-{% if data_layout %}12{% else %}8{% endif %} mb-4 order-1 order-lg-2">
      <h1>{{ info }}</h1>

      {% if info.image and info.type.name != "Video Recording" %}
        <img src="{{ info.image.large.url }}" class="img-fluid img-thumbnail rounded" alt="" />
      {% endif %}

      <!-- show media or export options -->
      {% if info.type.name == "Video Recording" or info.embed %}
        <section class="videoblock">
          {% if info.video %}
            {{ info.video.embed|safe }}
          {% else %}
            {{ info.embed|safe }}
          {% endif %}
        </section>

      {% elif info.type.name == "Podcast" %}
        <section class="podcast">
          {% if info.file_url or info.file %}
            <div class="audioblock row mt-4">
              <div class="col-lg-6">
                 <audio controls class="rounded">
                   <source src="{% if info.file_url %}{{ info.file_url }}{% else %}{{ info.file.url }}{% endif %}" type="audio/mp3">
                   Your browser does not support the audio tag.
                </audio>
              </div>
              <div class="col-lg-6">
                <a class="btn btn-primary" href="{% if info.file_url %}{{ info.file_url }}{% else %}{{ info.file.url }}{% endif %}">
                  <i class="fa fa-download"></i> Download
                </a>
              </div>
            </div>
          {% endif %}
        </section>
      {% else %}
        {% if show_export and False %}
          <section class="export">
            <div class="row">
              <div class="col-lg-4 mb-4">
                <h4>Save</h4>
                <div class="row">
                  <div class="col-md-12">
                    <a class="btn-icon" href="#">
                      <div class="title mb-0"><i class="fal fa-save fa-fw"></i> To my collection</div>
                    </a>
                  </div>
                  <div class="col-md-12">
                    <a class="btn-icon" href="#">
                      <div class="title mb-0"><i class="fal fa-folder-plus fa-fw"></i> Create new collection</div>
                    </a>
                  </div>
                </div>
              </div>
              <div class="col-lg-8 mb-4">
                <h4>Export</h4>
                <div class="row">

                  <div class="col-md-6">
                    <button class="btn-icon">
                      <div class="title mb-0"><i class="fal fa-file-export fa-fw"></i> RIS</div>
                    </button>
                  </div>
                  <div class="col-md-6">
                    <button class="btn-icon">
                      <div class="title mb-0"><i class="fal fa-file-export fa-fw"></i> Bibtex</div>
                    </button>
                  </div>
                  <div class="col-md-6">
                    <a class="btn-icon" href="#">
                      <div class="title mb-0"><i class="fal fa-quote-right fa-fw"></i> Citation</div>
                    </a>
                  </div>
                  <div class="col-md-6">
                    <a class="btn-icon" href="javascript:print()">
                      <div class="title mb-0"><i class="fal fa-print fa-fw"></i> Print</div>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </section>
        {% endif %}
      {% endif %}

      {% if info.description %}
        <section class="description">
          {{ info.get_description }}
        </section>
      {% endif %}

      {% if attachments or spaces %}
        {% if info.type.name == "Shapefile" or spaces %}
          <h3>Map</h3>
          {% if info.get_shapefile_plot %}
            {% if info.meta_data.processed and IS_DATA_PORTAL %}
              <a href="{% url URLS.MAP_ITEM info.id %}"><img src="{{ info.get_shapefile_plot }}" alt="" /></a>
            {% else %}
              <img class="rounded border" src="{{ info.get_shapefile_plot }}" alt="" />
            {% endif %}
          {% elif info.type.name == "Shapefile" %}
            <p><em>There is no preview plot available.</em></p>
            {% if info.meta_data.shapefile_plot_error %}
              <div class="alert alert-danger"><strong>Error:</strong><br>{{ info.meta_data.shapefile_plot_error }}</div>
            {% endif %}
            {% if curator and not info.get_shapefile_plot or DEBUG %}
              <a href="?create_shapefile_plot=true" class="btn btn-default-outline"><i class="fa fa-image"></i> Create preview map now.</a>
            {% endif %}
          {% endif %}
          {% if spaces and IS_DATA_PORTAL %}
            <a href="{% url URLS.MAP_ITEM info.id %}" class="btn btn-primary"><i class="fa fa-map"></i> View interactive map</a>
          {% endif %}
        {% endif %}
      {% endif %}

      {% if request.user.is_authenticated %}
        {% if info.comments %}
          <section class="notes">
            <h3>Uploader notes</h3>
            {{ info.comments|linebreaks }}
          </section>
        {% endif %}
      {% endif %}

      {% if PROJECT.slug == "untraceable" %}
        <div class="alert alert-warning">
          Uploaded by {{ info.uploader }}
        </div>
        <h3>Uploader notes</h3>
        {{ info.comments|linebreaks }}
      {% endif %}

      {% if info.is_part_of %}
        <section class="source mt-4">
          <h3>Original source</h3>
          <p>This item is part of <a href="../{{ info.is_part_of.id }}/">{{ info.is_part_of }}</a></p>
        </section>
      {% endif %}

      {% if info.children.all %}
        <section class="children mt-4">
          <h3>Available within this {{ info.type }}</h3>
          <div class="row">
            {% for each in info.children.all %}
              <div class="col-md-6 mb-3">
                <a class="card btn-card" href="../{{ each.id }}/">
                  {% if each.image %}
                    <img src="{{ each.image.thumbnail.url }}" class="card-img-top" alt="">
                  {% endif %}
                  <div class="card-body">
                    <h5 class="card-title">{{ each }}</h5>
                    <h6 class="card-subtitle mb-2 text-muted">{{ each.type }}</h6>
                  </div>
                </a>
              </div>
            {% endfor %}
          </div>
        </section>
      {% endif %}

      {% if info.spaces %}
        <section class="associated-spaces mt-3 hide-water">
          <h3>Associated space{{ info.spaces.count|pluralize }}</h3>
            {% for each in info.spaces.all %}
              {% if forloop.counter < 10 or "allspaces" in request.GET %}
                {% if URLS.SPACE %}
                  <a href="{% url URLS.SPACE each.id %}">{{ each }}</a>
                {% else %}
                  {{ each }}
                {% endif %}
                {% if not forloop.last %},{% endif %}
              {% endif %}
              {% if forloop.last and forloop.counter > 10 and not "allspaces" in request.GET %}... <a class="badge badge-dark" href="?allspaces=true">view all ({{ spaces.count }})</a>{% endif %}
            {% endfor %}
        </section>
      {% endif %}

      {% if spaces %}
        <section class="spaces">
          <h3>Part of this shapefile</h3>
          {% if spaces_message %}
            <div class="alert alert-warning">
              <i class="fa fa-info-circle"></i> {{ spaces_message }}
              <a href="{% url URLS.MAP_ITEM info.id %}">View all &raquo;</a>
            </div>
          {% endif %}
          <ul class="list-group list-group-flush">
            {% for each in spaces %}
              {% if URLS.SPACE %}
                <li class="list-group-item"><a href="{% url URLS.SPACE each.id %}">{{ each }}</a></li>
              {% else %}
                <li class="list-group-item">{{ each }}</li>
              {% endif %}
            {% endfor %}
          </ul>
        </section>
        {% if info.meta_data.processed and IS_DATA_PORTAL %}
          <a href="{% url URLS.MAP_ITEM info.id %}" class="btn btn-primary"><i class="fa fa-map"></i> View all &raquo;</a>
        {% endif %}
      {% endif %}

      {% if data_count %}
        <section>
          <h3>Data</h3>

          {% if all_data_viz %}
            <em>The following data visualisations are available:</em>
            <ul class="mt-2 mb-3">
              {% for each in all_data_viz %}
                <li>{% if each == active_data_viz %}{{ each }}{% else %}<a href="?data-viz={{ each.uid }}">{{ each }}</a>{% endif %}</li>
              {% endfor %}
            </ul>
          {% endif %}

          {% include "_data.visualizations.html" %}

          {% if active_data_viz %}
            <div class="mb-3"><a href="./">Back to main data visualisation</a></div>
          {% endif %}

        </section>
      {% endif %}

      {% if info.meta_data.ready_for_processing or "crunch" in request.GET %}
        <div class="alert alert-warning mt-3">
          <i class="fa fa-info-circle"></i> <strong>This file has been processed by one of our contributors.</strong>
          <br>
          Data visualisations should soon be available (it can take up to 6 hours for files to be crunched on our servers).
          {% if request.user.is_staff %}
            <hr>
            <form method="post" class="mt-3">
              <button class="btn btn-dark" type="submit"><i class="fa fa-server"></i> Let's crunch this file</button>
              <span class="ml-4 badge badge-primary">Staff only</span>
              <input type="hidden" name="process_file" value="true" />
              {% csrf_token %}
            </form>
          {% endif %}
        </div>
      {% endif %}

      {% if info.meta_data.processing_error %}
        <div class="alert alert-danger mt-3">
          <i class="fa fa-exclamation-triangle"></i> <strong>File processing error</strong>
          <br>
          We have tried processing this file, but have encountered an error.
          {{ info.meta_data.processing_error }}
        </div>
      {% endif %}

      {% if data_layout %}

        <form>

          <section class="row">
            <div class="col-md-6 col-lg-3 mb-4">
              <div class="card icon-card">
                <div class="icon">
                  <i class="far fa-fw fa-database"></i>
                </div>
                <div class="card-header">Material filter</div>
                <div class="card-body">
                  <p class="what-text">
                    Restrict search to these materials:
                  </p>
                  <select multiple class="form-control" name="materials">
                    {% for each in data_materials %}
                      <option {% if each.material_name in get_materials %}selected{% endif %} value="{{ each.material_name }}">
                        {{ each.material_name }}
                      </option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-lg-3 mb-4">
              <div class="card icon-card">
                <div class="icon">
                  <i class="far fa-fw fa-map"></i>
                </div>
                <div class="card-header">Location filter</div>
                <div class="card-body">
                  <p class="what-text">
                    Restrict data to what is linked to the following places:
                  </p>
                  <select multiple class="form-control" name="spaces">
                    {% for each in data_spaces %}
                      <option {% if each.id|slugify in get_spaces %}selected{% endif %} value="{{ each.id }}">{{ each.name }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-lg-3 mb-4">
              <div class="card icon-card">
                <div class="icon">
                  <i class="far fa-fw fa-calendar"></i>
                </div>
                <div class="card-header">Temporal filter</div>
                <div class="card-body">
                  <p class="what-text">
                    Filter data by setting a specific timeframe:
                  </p>
                  <select multiple class="form-control" name="timeframes">
                    {% for each in data_timeframes %}
                      <option {% if each.date_start__year|slugify in get_timeframes %}selected{% endif %} value="{{ each.date_start__year }}">
                        {{ each.date_start__year }}
                      </option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-lg-3 mb-4">
              <div class="card icon-card">
                <div class="icon">
                  <i class="far fa-fw fa-search"></i>
                </div>
                <div class="card-header">Apply filters</div>
                <div class="card-body">
                  <p class="what-text">
                    <button type="submit" class="btn btn-secondary">Apply filters</button>
                    <button type="submit" class="btn btn-secondary-outline mt-4">Reset all filters</button>
                  </p>
                </div>
              </div>
            </div>
          </section>

          <input type="hidden" name="data-layout" value="true" />
          <input type="hidden" name="do_not_cache" value="true" />

          <section class="row">
            <div class="card icon-card col-3">
              <div class="icon">
                <i class="far fa-fw fa-download"></i>
              </div>
              <div class="card-header">Download data</div>
              <div class="card-body">
                <p class="what-text">
                  There are a total of 
                  {{ data_count|intcomma }} data points in this dataset. Use the bottom below to download: <br>
                  <br>
                  <a href="#" class="btn btn-secondary">ALL datapoints</a>
                  <a href="#" class="btn btn-secondary-outline mt-3">Filtered datapoints</a>
                </p>
              </div>
            </div>
            <div class="card icon-card col-3">
              <div class="icon">
                <i class="far fa-fw fa-location"></i>
              </div>
              <div class="card-header">Geospatial boundary</div>
              <div class="card-body">
                <p class="what-text">
                  {% if boundaries %}
                  Data are only displayed if they occur within the following boundaries:
                  <strong>
                    {% with link=PROJECT.slug|add:":referencespace" %}
                      <a href="{% url link boundaries.id %}">
                      {{ boundaries }}
                      </a>
                    {% endwith %}
                  </strong>. <br><br>Boundaries are shown on the right.
                  {% else %}
                    <em>No geospatial boundary loaded.</em>
                  {% endif %}
                  <button type="button" data-toggle="modal" data-target="#searchSpace" class="btn btn-primary-outline mt-3">Load {% if boundaries %}different{% endif %} boundaries</button>
                </p>
              </div>
            </div>
            <div class="card icon-card col-6">
              {% if map %}
                <div class="leaflet-map">
                  {{ map|safe }}
                </div>
              {% endif %}
            </div>
          </section>

          <div class="modal fade" id="searchSpace" tabindex="-1" aria-labelledby="searchSpaceLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="searchSpaceLabel">Load new boundaries</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  We can apply a geospatial boundary to this dataset. That means that we only 
                  display data that is associated with a location within a certain boundary.
                  That boundary could be a region, municipality, country, etc. This only makes 
                  sense if your dataset covers an area <em>larger</em> than the boundary that
                  you select.
                  <div class="mt-4">
                    <select class="form-control" id="space_finder" name="boundaries">
                      {% if boundaries %}
                        <option selected value="{{ boundaries.id }}">{{ boundaries }}</option>
                      {% endif %}
                    </select>
                  </div>
                </div>
                <div class="modal-footer">

                  {% if request.GET.restrict_to_within_boundaries %}
                    <input type="hidden" name="restrict_to_within_boundaries" value="true" />
                  {% endif %}

                  <button class="btn btn-primary" type="submit">Apply boundaries</button>
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>

        </form>

      {% endif %}

      {% if attachments %}
        <h3 class="mt-4">Attachment(s)</h3>
        <ul>
        {% for each in attachments %}
          <li><a href="{{ each.get_file }}">{{ each }}</a> ({{ each.get_size }})</li>
        {% endfor %}
        </ul>
        {% if attachments.count > 2 %}
          <form method="post">
            <button type="submit" class="btn btn-default-outline" name="zipfile" value="true"><i class="fa fa-file-archive"></i> Download as zipfile</button>
            {% csrf_token %}
          </form>
        {% endif %}

      {% endif %}

      {% with link=PROJECT.slug|add:":report_error" %}
        <hr>
        <p class="text-muted">Something wrong with this information? <a href="{% url link info.id %}">Report errors here</a>.</p>
      {% endwith %}

      <div class="modal" tabindex="-1" id="citation">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Citation</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <nav>
                <div class="nav nav-pills nav-fill" id="citation-tab" role="tablist">
                  <a class="nav-item nav-link" data-tab="apa" id="nav-apa-tab" data-toggle="tab" href="#nav-apa" role="tab" aria-controls="nav-apa" aria-selected="false">APA</a>
                  <a class="nav-item nav-link" data-tab="bib" id="nav-bib-tab" data-toggle="tab" href="#nav-bib" role="tab" aria-controls="nav-bib" aria-selected="false">BibTeX</a>
                  <a class="nav-item nav-link" data-tab="ris" id="nav-ris-tab" data-toggle="tab" href="#nav-ris" role="tab" aria-controls="nav-ris" aria-selected="false">RIS</a>
                </div>
              </nav>
              <hr class="fullwidth-hr">
              <div class="tab-content">
                <div class="tab-pane" id="nav-apa" role="tabpanel" aria-labelledby="nav-apa-tab">
                  <div>{{ info.get_citation_apa }}</div>
                  <input hidden type="text" id="input-apa" value="{{ info.get_citation_apa }}">

                  <hr class="fullwidth-hr">

                  <div>
                    <div class="btn btn-primary copy-citation" data-citation="apa">
                      <i class="fal fa-copy"></i> <span class="text">Copy</span>
                    </div>
                    <button type="button" class="btn btn-primary-outline float-right" data-dismiss="modal">Close</button>
                  </div>
                </div>
                <div class="tab-pane" id="nav-bib" role="tabpanel" aria-labelledby="nav-bib-tab">
                  <code id="bib"></code>
                  <textarea hidden id="input-bib"></textarea>

                  <hr class="fullwidth-hr">

                  <div>
                    <div class="btn btn-primary copy-citation" data-citation="bib">
                      <i class="fal fa-copy"></i> <span class="text">Copy</span>
                    </div>
                    <a class="btn btn-primary" href="?format=bibtex&amp;download=true">
                      <i class="fal fa-download"></i> Download
                    </a>
                    <button type="button" class="btn btn-primary-outline float-right" data-dismiss="modal">Close</button>
                  </div>
                </div>
                <div class="tab-pane" id="nav-ris" role="tabpanel" aria-labelledby="nav-ris-tab">
                  <code id="ris"></code>
                  <textarea hidden id="input-ris"></textarea>

                  <hr class="fullwidth-hr">

                  <div>
                    <div class="btn btn-primary copy-citation" data-citation="ris">
                      <i class="fal fa-copy"></i> <span class="text">Copy</span>
                    </div>
                    <a class="btn btn-primary" href="?format=ris&amp;download=true">
                      <i class="fal fa-download"></i> Download
                    </a>
                    <button type="button" class="btn btn-primary-outline float-right" data-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      {% if request.user.is_superuser %}
      <section id="metadata" class="bg-white">
        <div class="border border-warning rounded mb-4">
          <div class="alert alert-warning">
            <i class="fal fa-lock mr-2"></i> <strong>Meta data</strong> | Available to super users only
            <i class="fa fa-plus float-right"></i>
          </div>

          <div class="contentblock">
            <h4 class="pl-3">Metadata</h4>

            {% if info.meta_data %}
              <ul class="list-group list-group-flush">
              {% for key,value in info.meta_data.items %}
                <li class="list-group-item table-item">
                  <div class="font-weight-bold">{{ key }}</div>
                  <div>{{ value }}</div>
                </li>
              {% endfor %}
              </ul>
            {% else %}
              <h5 class="pl-3">This file has no meta data</h5>
            {% endif %}
          </div>
        </div>
      </section>
      {% endif %}

      {% if PROJECT.slug == "ascus" or PROJECT.slug == "ascus2021" or PROJECT.slug == "ascus2024" %}
        <section class="messages">
          {% include "_messages.html" %}
        </section>
      {% endif %}

    </div>
  </div>
</div>
{% endblock %}

{% block footer %}
  {% if data_count %}
    <script>
      let unit = "{{ unit.unit__name|default:'various units' }}";
    </script>
    {% include "_chart.footer.html" %}
  {% endif %}

  {% if attachments %}
    <script>
      // Add csv
      const attachments = JSON.parse(document.getElementById("attachment-data").textContent);

      $("#exportCsv").on("click", function () {
        if (!attachments || attachments.length === 0) return;

        // Convert attachments to CSV format
        const headers = Object.keys(attachments[0]);
        const csvRows = [
          headers.join(","), // header row
          ...attachments.map(row =>
            headers.map(fieldName => `"${(row[fieldName] ?? "").toString().replace(/"/g, '""')}"`).join(",")
          )
        ];

        const csvContent = csvRows.join("\n");

        // Create a Blob and trigger download
        const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "attachments_export.csv";
        a.style.display = "none";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);

        closeModal();
      });
    </script>
  {% endif %}

  <script>
    let loadedBib = false
    let loadedRis = false

    $(".load-citation").click(function() {
      if (loadedBib == false) {
        $.get("?format=bibtex", function(data) {
          $("#bib, #input-bib").html(data)
          loadedBib = true;
        })
      }

      if (loadedRis == false) {
        $.get("?format=ris", function(data) {
          $("#ris, #input-ris").html(data)
          loadedRis = true;
        })
      }

      let tab = $(this).data("tab");

      $("#citation .nav-item, #citation .tab-pane").removeClass("active");
      $("#nav-" + tab + "-tab, #nav-" + tab).addClass("active");
    })

    // copy citation
    function copyCitation(format) {
      // Get the text field
      var citation = document.getElementById("input-" + format);

      // Select the text field
      citation.select();
      citation.setSelectionRange(0, 99999); // For mobile devices //

      // Copy the text inside the text field
      navigator.clipboard.writeText(citation.value);
    }

    $(".copy-citation").click(function() {
      let button = $(this)
      let format = button.data("citation")
      copyCitation(format);

      button.find("i").removeClass("fa-copy").addClass("fa-check")
      button.find(".text").text("Copied to clipboard")

      setTimeout(function(){
        button.find("i").removeClass("fa-check").addClass("fa-copy")
        button.find(".text").text("Copy")
      }, 5000);
    })

    {% if request.user.is_superuser %}
    $("#metadata .alert").click(function() {
      $("#metadata .contentblock").toggle();
    });
    {% endif %}

    {% if request.user.is_staff %}
      $("#view-admin-options").click(function(e){
        e.preventDefault();
        $(this).hide()
        $(".admin-option").show();
      });
    {% endif %}

    {% if data_layout %}
      $("#space_finder").select2({
        theme: "bootstrap4",
        ajax: {
          {% with link=PROJECT.slug|add:":search_spaces_ajax" %}
          url: "{% url link %}?has_geometry=true&local_search=true",
          {% endwith %}
          dataType: "json"
        }
      });
    {% endif %}

    $(document).ready(function () {
      $(".export-btn").on("click", function () {
        $("#exportModalOverlay").fadeIn(200);
        $("#exportModal").show().addClass("show");
      });

      $(".close-modal, #exportModalOverlay").on("click", function () {
        $("#exportModal").removeClass("show");
        setTimeout(() => {
          $("#exportModal").hide();
          $("#exportModalOverlay").fadeOut(200);
        }, 300);
      });

      // Export TXT functionality
      $("#exportTxt").on("click", function () {
        // Get all visible text content from the page
        const content = $("body").text().trim();

        const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
        const url = URL.createObjectURL(blob);

        const link = document.createElement("a");
        link.href = url;
        link.download = "page-export.txt";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);

        closeModal();
      });

      // Export as PDF file
      $("#exportPdf").on("click", function () {
        // Close the modal before generating the PDF
        closeModal(); // Ensure this closes any modals containing loading content

        // Delay PDF generation to ensure the modal is fully closed
        setTimeout(function() {
          const element = document.body; 

          const opt = {
            margin:       0.5,
            filename:     'page-export.pdf',
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 2 },
            jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
          };

          html2pdf().set(opt).from(element).save();
        }, 1000);  // Delay to ensure modal is hidden before export
      });

      // add to zotero library
      $('#exportZotero').on('click', function () {
        window.location.href = 'zotero/oauth/start/';
      });

      // If add this item to the user's zotero successfully
      $(document).ready(function() {
        const params = new URLSearchParams(window.location.search);
        if (params.get("zotero_export") === "success") {
          $("#zoteroSuccessModal").fadeIn();

          // Optional: close modal on click
          $(".close-modal").on("click", function () {
            $("#zoteroSuccessModal").fadeOut();
          });

          // Optional: auto-hide after 5 seconds
          setTimeout(() => {
            $("#zoteroSuccessModal").fadeOut();
          }, 5000);
        }
      });


      // Close modal helper
      function closeModal() {
        $("#exportModal").removeClass("show");
        setTimeout(() => {
          $("#exportModal").hide();
          $("#exportModalOverlay").fadeOut(200);
        }, 300);
      }
    });

    // this will show whenever the item is added successfully into the user's zotero library
    $(document).ready(function () {
      const params = new URLSearchParams(window.location.search);

      if (params.get("zotero_export") === "success") {
        $("#zoteroSuccessModal").addClass("show");
        $("#zoteroSuccessModalOverlay").fadeIn();

        // Close manually
        $(".close-modal").on("click", function () {
          $("#zoteroSuccessModal").removeClass("show");
          $("#zoteroSuccessModalOverlay").fadeOut();
        });

        // Auto close after 4 seconds
        setTimeout(() => {
          $("#zoteroSuccessModal").removeClass("show");
          $("#zoteroSuccessModalOverlay").fadeOut();
        }, 4000);
      }
    });

    function openSharePopup() {
      $("#sharePopup").css("display", "block");
      $("#overlay").css("display", "block");

      // Add animation class after a small delay
      setTimeout(() => {
        $("#sharePopup").addClass("show");
      }, 100);
    }

    function closeSharePopup() {
      $("#sharePopup").removeClass("show");

      // Hide the popup after animation
      setTimeout(() => {
        $("#sharePopup").css("display", "none");
        $("#overlay").css("display", "none");
      }, 300);
    }

    // URL to be shared
    const shareURL = window.location.href;

    // Share via Email
    function shareEmail() {
      const subject = encodeURIComponent("Check this out!");
      const body = encodeURIComponent(`I found this interesting: ${shareURL}`);
      window.open(`https://mail.google.com/mail/?view=cm&fs=1&su=${subject}&body=${body}`, "_blank");
    }

    // Share via Outlook
    function shareOutlook() {
      const subject = encodeURIComponent("Check this out!");
      const body = encodeURIComponent(`I found this interesting: ${shareURL}`);
      window.location.href = `mailto:?subject=${subject}&body=${body}`;
    }

    // Share via Facebook
    function shareFacebook() {
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${shareURL}`, "_blank");
    }

    // Share via Twitter (X)
    function shareTwitter() {
      window.open(`https://twitter.com/intent/tweet?url=${shareURL}&text=Check this out!`, "_blank");
    }

    // Share via LinkedIn
    function shareLinkedIn() {
      window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${shareURL}`, "_blank");
    } 

    // Share via Reddit
    function shareReddit() {
      window.open(`https://www.reddit.com/submit?url=${shareURL}&title=Check this out!`, "_blank");
    }
  </script>
{% endblock %}
